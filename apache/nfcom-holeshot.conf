<VirtualHost *:80>
    ServerName brazcom.com.br

    # IMPORTANTE: A ordem importa! /api DEVE vir ANTES de /
    ProxyPreserveHost On

    # Backend API - DEVE VIR PRIMEIRO
    # Usar ProxyPass com nocanon para preservar URLs exatamente como enviadas
    ProxyPass /api/ http://127.0.0.1:8015/ nocanon
    ProxyPassReverse /api/ http://127.0.0.1:8015/
    ProxyPassReverseCookiePath /api/ /

    # Configurações adicionais para evitar redirects e cache
    ProxyPreserveHost Off
    ProxyRequests Off

    # Arquivos estáticos do backend (se houver)
    ProxyPass /files/ http://127.0.0.1:8015/files/
    ProxyPassReverse /files/ http://127.0.0.1:8015/files/

    # Frontend - vem depois (excluindo /api e /files)
    ProxyPass / http://127.0.0.1:3015/
    ProxyPassReverse / http://127.0.0.1:3015/

    # Headers para Cloudflare
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-For "%{REMOTE_ADDR}s"

    # Headers adicionais para evitar cache e redirects
    RequestHeader set X-Forwarded-Host %{HTTP_HOST}s

    # Headers para desabilitar cache
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
</VirtualHost>

# Módulos necessários:
# sudo a2enmod proxy proxy_http proxy_wstunnel headers rewrite ssl
# sudo systemctl restart apache2
